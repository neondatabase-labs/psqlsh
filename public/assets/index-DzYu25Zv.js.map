{"version":3,"file":"index-DzYu25Zv.js","sources":["../../../node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/loader.js","../../../node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/utils.js","../../../node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/index.js"],"sourcesContent":["import { __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nimport { loadScript, unloadScript } from '../../lib/load-script';\nfunction normalizeName(name) {\n    return name.toLowerCase().replace('.', '').replace(/\\s+/g, '-');\n}\nfunction obfuscatePathName(pathName, obfuscate) {\n    if (obfuscate === void 0) { obfuscate = false; }\n    return obfuscate ? btoa(pathName).replace(/=/g, '') : undefined;\n}\nexport function resolveIntegrationNameFromSource(integrationSource) {\n    return ('Integration' in integrationSource\n        ? integrationSource.Integration\n        : integrationSource).prototype.name;\n}\nfunction recordLoadMetrics(fullPath, ctx, name) {\n    var _a, _b;\n    try {\n        var metric = ((_b = (_a = window === null || window === void 0 ? void 0 : window.performance) === null || _a === void 0 ? void 0 : _a.getEntriesByName(fullPath, 'resource')) !== null && _b !== void 0 ? _b : [])[0];\n        // we assume everything that took under 100ms is cached\n        metric &&\n            ctx.stats.gauge('legacy_destination_time', Math.round(metric.duration), __spreadArray([\n                name\n            ], (metric.duration < 100 ? ['cached'] : []), true));\n    }\n    catch (_) {\n        // not available\n    }\n}\nexport function buildIntegration(integrationSource, integrationSettings, analyticsInstance) {\n    var integrationCtr;\n    // GA and Appcues use a different interface to instantiating integrations\n    if ('Integration' in integrationSource) {\n        var analyticsStub = {\n            user: function () { return analyticsInstance.user(); },\n            addIntegration: function () { },\n        };\n        integrationSource(analyticsStub);\n        integrationCtr = integrationSource.Integration;\n    }\n    else {\n        integrationCtr = integrationSource;\n    }\n    var integration = new integrationCtr(integrationSettings);\n    integration.analytics = analyticsInstance;\n    return integration;\n}\nexport function loadIntegration(ctx, name, version, obfuscate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var pathName, obfuscatedPathName, path, fullPath, err_1, deps;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    pathName = normalizeName(name);\n                    obfuscatedPathName = obfuscatePathName(pathName, obfuscate);\n                    path = getNextIntegrationsURL();\n                    fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, loadScript(fullPath)];\n                case 2:\n                    _a.sent();\n                    recordLoadMetrics(fullPath, ctx, name);\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_1 = _a.sent();\n                    ctx.stats.gauge('legacy_destination_time', -1, [\"plugin:\".concat(name), \"failed\"]);\n                    throw err_1;\n                case 4:\n                    deps = window[\"\".concat(pathName, \"Deps\")];\n                    return [4 /*yield*/, Promise.all(deps.map(function (dep) { return loadScript(path + dep + '.gz'); }))\n                        // @ts-ignore\n                    ];\n                case 5:\n                    _a.sent();\n                    // @ts-ignore\n                    window[\"\".concat(pathName, \"Loader\")]();\n                    return [2 /*return*/, window[\n                        // @ts-ignore\n                        \"\".concat(pathName, \"Integration\")]];\n            }\n        });\n    });\n}\nexport function unloadIntegration(name, version, obfuscate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var path, pathName, obfuscatedPathName, fullPath;\n        return __generator(this, function (_a) {\n            path = getNextIntegrationsURL();\n            pathName = normalizeName(name);\n            obfuscatedPathName = obfuscatePathName(name, obfuscate);\n            fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n            return [2 /*return*/, unloadScript(fullPath)];\n        });\n    });\n}\nexport function resolveVersion(integrationConfig) {\n    var _a, _b, _c, _d;\n    return ((_d = (_b = (_a = integrationConfig === null || integrationConfig === void 0 ? void 0 : integrationConfig.versionSettings) === null || _a === void 0 ? void 0 : _a.override) !== null && _b !== void 0 ? _b : (_c = integrationConfig === null || integrationConfig === void 0 ? void 0 : integrationConfig.versionSettings) === null || _c === void 0 ? void 0 : _c.version) !== null && _d !== void 0 ? _d : 'latest');\n}\n//# sourceMappingURL=loader.js.map","export var isInstallableIntegration = function (name, integrationSettings) {\n    var _a;\n    var type = integrationSettings.type, bundlingStatus = integrationSettings.bundlingStatus, versionSettings = integrationSettings.versionSettings;\n    // We use `!== 'unbundled'` (versus `=== 'bundled'`) to be inclusive of\n    // destinations without a defined value for `bundlingStatus`\n    var deviceMode = bundlingStatus !== 'unbundled' &&\n        (type === 'browser' || ((_a = versionSettings === null || versionSettings === void 0 ? void 0 : versionSettings.componentTypes) === null || _a === void 0 ? void 0 : _a.includes('browser')));\n    // checking for iterable is a quick fix we need in place to prevent\n    // errors showing Iterable as a failed destiantion. Ideally, we should\n    // fix the Iterable metadata instead, but that's a longer process.\n    return !name.startsWith('Segment') && name !== 'Iterable' && deviceMode;\n};\nexport var isDisabledIntegration = function (integrationName, globalIntegrations) {\n    var allDisableAndNotDefined = globalIntegrations.All === false &&\n        globalIntegrations[integrationName] === undefined;\n    return (globalIntegrations[integrationName] === false || allDisableAndNotDefined);\n};\n//# sourceMappingURL=utils.js.map","import { __assign, __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { Alias, Group, Identify, Page, Track } from '@segment/facade';\nimport { isOffline, isOnline } from '../../core/connection';\nimport { Context, ContextCancelation } from '../../core/context';\nimport { isServer } from '../../core/environment';\nimport { attempt } from '@segment/analytics-core';\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled';\nimport { mergedOptions } from '../../lib/merged-options';\nimport { pWhile } from '../../lib/p-while';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { applyDestinationMiddleware, } from '../middleware';\nimport { buildIntegration, loadIntegration, resolveIntegrationNameFromSource, resolveVersion, unloadIntegration, } from './loader';\nimport { isPlainObject } from '@segment/analytics-core';\nimport { isDisabledIntegration as shouldSkipIntegration, isInstallableIntegration, } from './utils';\nimport { recordIntegrationMetric } from '../../core/stats/metric-helpers';\nimport { createDeferred } from '@segment/analytics-generic-utils';\nfunction flushQueue(xt, queue) {\n    return __awaiter(this, void 0, void 0, function () {\n        var failedQueue;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    failedQueue = [];\n                    if (isOffline()) {\n                        return [2 /*return*/, queue];\n                    }\n                    return [4 /*yield*/, pWhile(function () { return queue.length > 0 && isOnline(); }, function () { return __awaiter(_this, void 0, void 0, function () {\n                            var ctx, result, success;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        ctx = queue.pop();\n                                        if (!ctx) {\n                                            return [2 /*return*/];\n                                        }\n                                        return [4 /*yield*/, attempt(ctx, xt)];\n                                    case 1:\n                                        result = _a.sent();\n                                        success = result instanceof Context;\n                                        if (!success) {\n                                            failedQueue.push(ctx);\n                                        }\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); })\n                        // re-add failed tasks\n                    ];\n                case 1:\n                    _a.sent();\n                    // re-add failed tasks\n                    failedQueue.map(function (failed) { return queue.pushWithBackoff(failed); });\n                    return [2 /*return*/, queue];\n            }\n        });\n    });\n}\nvar LegacyDestination = /** @class */ (function () {\n    function LegacyDestination(name, version, writeKey, settings, options, integrationSource) {\n        if (settings === void 0) { settings = {}; }\n        var _this = this;\n        this.options = {};\n        this.type = 'destination';\n        this.middleware = [];\n        this.initializePromise = createDeferred();\n        this.flushing = false;\n        this.name = name;\n        this.version = version;\n        this.settings = __assign({}, settings);\n        this.disableAutoISOConversion = options.disableAutoISOConversion || false;\n        this.integrationSource = integrationSource;\n        // AJS-Renderer sets an extraneous `type` setting that clobbers\n        // existing type defaults. We need to remove it if it's present\n        if (this.settings['type'] && this.settings['type'] === 'browser') {\n            delete this.settings['type'];\n        }\n        this.initializePromise.promise.then(function (isInitialized) { return (_this._initialized = isInitialized); }, function () { });\n        this.options = options;\n        this.buffer = options.disableClientPersistence\n            ? new PriorityQueue(4, [])\n            : new PersistedPriorityQueue(4, \"\".concat(writeKey, \":dest-\").concat(name));\n        this.scheduleFlush();\n    }\n    LegacyDestination.prototype.isLoaded = function () {\n        return !!this._ready;\n    };\n    LegacyDestination.prototype.ready = function () {\n        var _this = this;\n        return this.initializePromise.promise.then(function () { var _a; return (_a = _this.onReady) !== null && _a !== void 0 ? _a : Promise.resolve(); });\n    };\n    LegacyDestination.prototype.load = function (ctx, analyticsInstance) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var integrationSource, _b;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (this._ready || this.onReady !== undefined) {\n                            return [2 /*return*/];\n                        }\n                        if (!((_a = this.integrationSource) !== null && _a !== void 0)) return [3 /*break*/, 1];\n                        _b = _a;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, loadIntegration(ctx, this.name, this.version, this.options.obfuscate)];\n                    case 2:\n                        _b = (_c.sent());\n                        _c.label = 3;\n                    case 3:\n                        integrationSource = _b;\n                        this.integration = buildIntegration(integrationSource, this.settings, analyticsInstance);\n                        this.onReady = new Promise(function (resolve) {\n                            var onReadyFn = function () {\n                                _this._ready = true;\n                                resolve(true);\n                            };\n                            _this.integration.once('ready', onReadyFn);\n                        });\n                        this.integration.on('initialize', function () {\n                            _this.initializePromise.resolve(true);\n                        });\n                        try {\n                            recordIntegrationMetric(ctx, {\n                                integrationName: this.name,\n                                methodName: 'initialize',\n                                type: 'classic',\n                            });\n                            this.integration.initialize();\n                        }\n                        catch (error) {\n                            recordIntegrationMetric(ctx, {\n                                integrationName: this.name,\n                                methodName: 'initialize',\n                                type: 'classic',\n                                didError: true,\n                            });\n                            this.initializePromise.resolve(false);\n                            throw error;\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.unload = function (_ctx, _analyticsInstance) {\n        return unloadIntegration(this.name, this.version, this.options.obfuscate);\n    };\n    LegacyDestination.prototype.addMiddleware = function () {\n        var _a;\n        var fn = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            fn[_i] = arguments[_i];\n        }\n        this.middleware = (_a = this.middleware).concat.apply(_a, fn);\n    };\n    LegacyDestination.prototype.shouldBuffer = function (ctx) {\n        return (\n        // page events can't be buffered because of destinations that automatically add page views\n        ctx.event.type !== 'page' &&\n            (isOffline() || this._ready !== true || this._initialized !== true));\n    };\n    LegacyDestination.prototype.send = function (ctx, clz, eventType) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function () {\n            var plan, ev, planEvent, afterMiddleware, event, err_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (this.shouldBuffer(ctx)) {\n                            this.buffer.push(ctx);\n                            this.scheduleFlush();\n                            return [2 /*return*/, ctx];\n                        }\n                        plan = (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.plan) === null || _b === void 0 ? void 0 : _b.track;\n                        ev = ctx.event.event;\n                        if (plan && ev && this.name !== 'Segment.io') {\n                            planEvent = plan[ev];\n                            if (!isPlanEventEnabled(plan, planEvent)) {\n                                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), { All: false, 'Segment.io': true }));\n                                ctx.cancel(new ContextCancelation({\n                                    retry: false,\n                                    reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                                    type: 'Dropped by plan',\n                                }));\n                            }\n                            else {\n                                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations));\n                            }\n                            if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) && (planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations[this.name]) === false) {\n                                ctx.cancel(new ContextCancelation({\n                                    retry: false,\n                                    reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                                    type: 'Dropped by plan',\n                                }));\n                            }\n                        }\n                        return [4 /*yield*/, applyDestinationMiddleware(this.name, ctx.event, this.middleware)];\n                    case 1:\n                        afterMiddleware = _c.sent();\n                        if (afterMiddleware === null) {\n                            return [2 /*return*/, ctx];\n                        }\n                        event = new clz(afterMiddleware, {\n                            traverse: !this.disableAutoISOConversion,\n                        });\n                        recordIntegrationMetric(ctx, {\n                            integrationName: this.name,\n                            methodName: eventType,\n                            type: 'classic',\n                        });\n                        _c.label = 2;\n                    case 2:\n                        _c.trys.push([2, 5, , 6]);\n                        if (!this.integration) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.integration.invoke.call(this.integration, eventType, event)];\n                    case 3:\n                        _c.sent();\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        err_1 = _c.sent();\n                        recordIntegrationMetric(ctx, {\n                            integrationName: this.name,\n                            methodName: eventType,\n                            type: 'classic',\n                            didError: true,\n                        });\n                        throw err_1;\n                    case 6: return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.track = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Track, 'track')];\n            });\n        });\n    };\n    LegacyDestination.prototype.page = function (ctx) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (((_a = this.integration) === null || _a === void 0 ? void 0 : _a._assumesPageview) && !this._initialized) {\n                            this.integration.initialize();\n                        }\n                        return [4 /*yield*/, this.initializePromise.promise];\n                    case 1:\n                        _b.sent();\n                        return [2 /*return*/, this.send(ctx, Page, 'page')];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.identify = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Identify, 'identify')];\n            });\n        });\n    };\n    LegacyDestination.prototype.alias = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Alias, 'alias')];\n            });\n        });\n    };\n    LegacyDestination.prototype.group = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Group, 'group')];\n            });\n        });\n    };\n    LegacyDestination.prototype.scheduleFlush = function () {\n        var _this = this;\n        if (this.flushing) {\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (isOffline() || this._ready !== true || this._initialized !== true) {\n                            this.scheduleFlush();\n                            return [2 /*return*/];\n                        }\n                        this.flushing = true;\n                        _a = this;\n                        return [4 /*yield*/, flushQueue(this, this.buffer)];\n                    case 1:\n                        _a.buffer = _b.sent();\n                        this.flushing = false;\n                        if (this.buffer.todo > 0) {\n                            this.scheduleFlush();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); }, Math.random() * 5000);\n    };\n    return LegacyDestination;\n}());\nexport { LegacyDestination };\nexport function ajsDestinations(writeKey, settings, globalIntegrations, options, routingMiddleware, legacyIntegrationSources) {\n    var _a, _b;\n    if (globalIntegrations === void 0) { globalIntegrations = {}; }\n    if (options === void 0) { options = {}; }\n    if (isServer()) {\n        return [];\n    }\n    if (settings.plan) {\n        options = options !== null && options !== void 0 ? options : {};\n        options.plan = settings.plan;\n    }\n    var routingRules = (_b = (_a = settings.middlewareSettings) === null || _a === void 0 ? void 0 : _a.routingRules) !== null && _b !== void 0 ? _b : [];\n    var remoteIntegrationsConfig = settings.integrations;\n    var localIntegrationsConfig = options.integrations;\n    // merged remote CDN settings with user provided options\n    var integrationOptions = mergedOptions(settings, options !== null && options !== void 0 ? options : {});\n    var adhocIntegrationSources = legacyIntegrationSources === null || legacyIntegrationSources === void 0 ? void 0 : legacyIntegrationSources.reduce(function (acc, integrationSource) {\n        var _a;\n        return (__assign(__assign({}, acc), (_a = {}, _a[resolveIntegrationNameFromSource(integrationSource)] = integrationSource, _a)));\n    }, {});\n    var installableIntegrations = new Set(__spreadArray(__spreadArray([], Object.keys(remoteIntegrationsConfig).filter(function (name) {\n        return isInstallableIntegration(name, remoteIntegrationsConfig[name]);\n    }), true), Object.keys(adhocIntegrationSources || {}).filter(function (name) {\n        return isPlainObject(remoteIntegrationsConfig[name]) ||\n            isPlainObject(localIntegrationsConfig === null || localIntegrationsConfig === void 0 ? void 0 : localIntegrationsConfig[name]);\n    }), true));\n    return Array.from(installableIntegrations)\n        .filter(function (name) { return !shouldSkipIntegration(name, globalIntegrations); })\n        .map(function (name) {\n        var integrationSettings = remoteIntegrationsConfig[name];\n        var version = resolveVersion(integrationSettings);\n        var destination = new LegacyDestination(name, version, writeKey, integrationOptions[name], options, adhocIntegrationSources === null || adhocIntegrationSources === void 0 ? void 0 : adhocIntegrationSources[name]);\n        var routing = routingRules.filter(function (rule) { return rule.destinationName === name; });\n        if (routing.length > 0 && routingMiddleware) {\n            destination.addMiddleware(routingMiddleware);\n        }\n        return destination;\n    });\n}\n//# sourceMappingURL=index.js.map"],"names":["normalizeName","name","obfuscatePathName","pathName","obfuscate","resolveIntegrationNameFromSource","integrationSource","recordLoadMetrics","fullPath","ctx","_a","_b","metric","__spreadArray","buildIntegration","integrationSettings","analyticsInstance","integrationCtr","analyticsStub","integration","loadIntegration","version","__awaiter","obfuscatedPathName","path","err_1","deps","__generator","getNextIntegrationsURL","loadScript","dep","unloadIntegration","unloadScript","resolveVersion","integrationConfig","_c","_d","isInstallableIntegration","type","bundlingStatus","versionSettings","deviceMode","isDisabledIntegration","integrationName","globalIntegrations","allDisableAndNotDefined","flushQueue","xt","queue","failedQueue","_this","isOffline","pWhile","isOnline","result","success","attempt","Context","failed","LegacyDestination","writeKey","settings","options","createDeferred","__assign","isInitialized","PriorityQueue","PersistedPriorityQueue","resolve","onReadyFn","recordIntegrationMetric","error","_ctx","_analyticsInstance","fn","_i","clz","eventType","plan","ev","planEvent","afterMiddleware","event","isPlanEventEnabled","ContextCancelation","applyDestinationMiddleware","Track","Page","Identify","Alias","Group","ajsDestinations","routingMiddleware","legacyIntegrationSources","isServer","routingRules","remoteIntegrationsConfig","localIntegrationsConfig","integrationOptions","mergedOptions","adhocIntegrationSources","acc","installableIntegrations","isPlainObject","shouldSkipIntegration","destination","routing","rule"],"mappings":"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","x_google_ignoreList":[0,1,2]}